{"version":3,"sources":["app/node_modules/browserify/node_modules/browser-pack/_prelude.js","app/scripts/main.js","app/scripts/pokey/adapter_base.js","app/scripts/pokey/adapter_iframe.js","app/scripts/pokey/channel.js","app/scripts/pokey/connect.js","app/scripts/pokey/events.js","app/scripts/pokey/main.js","app/scripts/pokey/port.js","app/scripts/pokey/sandbox.js","app/scripts/pokey/service.js","app/scripts/pokey/utils.js"],"names":[],"mappings":"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","file":"app/bundle.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nimport Pokey from './pokey/main';\n\n////////////////////\n\nlet log = document.querySelector('#log');\n\nfunction addLogStatement (statement) {\n  let p = document.createElement('p');\n  let d = new Date();\n  p.textContent = '' + statement + ' @ ' + [d.getMinutes(), d.getSeconds(), d.getMilliseconds()].join('.');\n  log.appendChild(p);\n}\n\naddLogStatement('initialized');\n\n\n/**********\n OASIS\n **********/\n\nvar sandbox = oasis.createSandbox({\n  url         : 'http://127.0.0.1:3000/external.html',\n  type        : 'html',\n  capabilities: ['account'],\n  height: \"600\"\n});\n\nsandbox.connect('account').then(function (port) {\n  addLogStatement('connected on account');\n\n  port.onRequest('profile', function () {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve({email: 'wycats@gmail.com'});\n      }, 1);\n    });\n  });\n\n  document.querySelector('#email-input').addEventListener('keyup', function (event) {\n    addLogStatement('sent');\n    port.request('setProfile', event.target.value);\n  });\n});\n\ndocument.getElementById('insertion').appendChild(sandbox.el);","import Channel from './channel';\nimport {mustImplement} from './utils';\n\nclass AdapterBase {\n  constructor() {}\n\n  createChannel (pokey) {\n    let channel = new Channel(pokey);\n    channel.port1.start();\n    return channel;\n  }\n\n  //todo - signature update\n  connectSandbox (receiver, pokey) {\n    let adapter = this;\n\n\n  }\n\n  static environmentPort (sandbox, channel) {\n    return channel.port1;\n  }\n\n  static sandboxPort (sandbox, channel) {\n    return channel.port2;\n  }\n\n  static proxyPort (sandbox, port) {\n    return port;\n  }\n\n}\n\nObject.assign(AdapterBase, {\n  initializeSandbox: mustImplement('AdapterBase', 'initializeSandbox')\n});\n\n//note - cannot assign readonly field name\n\nexport default AdapterBase;","import AdapterBase from './adapter_base';\n\nclass AdapterIFrame extends AdapterBase {\n  constructor () {\n    super();\n  }\n\n  static name (sandbox) {\n    return sandbox.el.name;\n  }\n\n  initializeSandbox (sandbox) {\n    //todo\n\n    let options           = sandbox.options,\n        iframe            = document.createElement('iframe'),\n        sandboxAttributes = ['allow-scripts']; //can allow more...\n\n    iframe.name    = sandbox.options.url + '?uuid=' + UUID.generate();\n    iframe.sandbox = sandboxAttributes.join(' ');\n\n    // rendering-specific code\n    if (options.width) {\n      iframe.width = options.width;\n    } else if (options.height) {\n      iframe.height = options.height;\n    }\n\n    // Error handling inside the iFrame\n    iframe.errorHandler = function (event) {\n      if (!event.data.sandboxException) {\n        return;\n      }\n      try {\n        // verify this message came from the expected sandbox; try/catch\n        // because ie8 will disallow reading contentWindow in the case of\n        // another sandbox's message\n        if (event.source !== iframe.contentWindow) {\n          return;\n        }\n      } catch (e) {\n        return;\n      }\n\n      sandbox.onerror(event.data.sandboxException);\n    };\n    window.addEventListener('message', iframe.errorHandler, false);\n\n    //verify\n    verifySandbox(sandbox.pokey, sandbox.options.url);\n    iframe.src          = sandbox.options.url;\n\n    // Promise that sandbox has loaded and services connected at least once. This does not mean that the sandbox will be loaded & connected in the face of reconnects (eg pages that navigate)\n    sandbox._waitForLoadPromise.resolve(new Promise(function (resolve, reject) {\n      iframe.initializationHandler = function (event) {\n        if (event.data !== sandbox.adapter.sandboxInitializedMessage) {\n          return;\n        }\n        try {\n          // verify this message came from the expected sandbox; try/catch because ie8 will disallow reading contentWindow in the case of another sandbox's message\n          if (event.source !== iframe.contentWindow) {\n            return;\n          }\n        } catch (e) {\n          return;\n        }\n        window.removeEventListener('message', iframe.initializationHandler);\n\n        sandbox.pokey.configuration.eventCallback(function () {\n          //iframe sandbox has initialized (services connected)\n          resolve(sandbox);\n        });\n      };\n      window.addEventListener('message', iframe.initializationHandler);\n    }));\n\n    sandbox.el = iframe;\n\n    iframe.oasisLoadHandler = function (event) {\n      if (event.data !== sandbox.adapter.oasisLoadedMessage) {\n        return;\n      }\n      try {\n        // verify this message came from the expected sandbox; try/catch\n        // because ie8 will disallow reading contentWindow in the case of\n        // another sandbox's message\n        if (event.source !== iframe.contentWindow) {\n          return;\n        }\n      } catch (e) {\n        return;\n      }\n\n      //iFrame has loaded Pokey...\n\n      if (verifyCurrentSandboxOrigin(sandbox, event)) {\n        //todo ---- transfer services to new iframe\n      }\n\n      if (sandbox.options.reconnect === \"none\") {\n        window.removeEventListener('message', iframe.oasisLoadHandler);\n      }\n    };\n    window.addEventListener('message', iframe.oasisLoadHandler);\n  }\n\n  terminateSandbox () {\n\n  }\n\n  connectPorts () {\n\n  }\n\n  connectSandbox (pokey) {\n    //todo - make static method\n    AdapterBase.prototype.connectSandbox.call(this, window, pokey);\n  }\n}\n\nfunction verifySandbox (pokey, sandboxUrl) {\n  var iframe = document.createElement('iframe'),\n      link;\n\n  if ((pokey.configuration.allowSameOrigin && iframe.sandbox !== undefined) ||\n    (iframe.sandbox === undefined)) {\n    // The sandbox attribute isn't supported (IE8/9) or we want a child iframe\n    // to access resources from its own domain (youtube iframe),\n    // we need to make sure the sandbox is loaded from a separate domain\n    link      = document.createElement('a');\n    link.href = sandboxUrl;\n\n    if (!link.host || (link.protocol === window.location.protocol && link.host === window.location.host)) {\n      throw new Error(\"Security: iFrames from the same host cannot be sandboxed in older browsers and is disallowed. For HTML5 browsers supporting the `sandbox` attribute on iframes, you can add the `allow-same-origin` flag only if you host the sandbox on a separate domain.\");\n    }\n  }\n\n\n}\n\nfunction verifyCurrentSandboxOrigin (sandbox, event) {\n  var linkOriginal, linkCurrent;\n\n  if (sandbox.firstLoad || sandbox.options.reconnect === \"any\") {\n    return true;\n  }\n\n  if (!sandbox.pokey.configuration.allowSameOrigin || event.origin === \"null\") {\n    fail();\n  } else {\n    linkOriginal = document.createElement('a');\n    linkCurrent  = document.createElement('a');\n\n    linkOriginal.href = sandbox.options.url;\n    linkCurrent.href  = event.origin;\n\n    if (linkCurrent.protocol === linkOriginal.protocol &&\n      linkCurrent.host === linkOriginal.host) {\n      return true;\n    }\n\n    fail();\n  }\n\n  function fail () {\n    sandbox.onerror(\n      new Error(\"Error reconnecting...\"));\n  }\n}\n\nexport default AdapterIFrame;","import {mustImplement} from './utils';\nimport Port from './port';\n\nclass Channel {\n  constructor (pokey) {\n    this.channel = new MessageChannel();\n\n    this.port1 = new Port(pokey, this.channel.port1);\n    this.port2 = new Port(pokey, this.channel.port2);\n  }\n\n  start () {\n    this.port1.start();\n    this.port2.start();\n  }\n\n  destroy () {\n    this.port1.close();\n    this.port2.close();\n    delete this.port1;\n    delete this.port2;\n    delete this.channel;\n  }\n\n}\n\nChannel.start = mustImplement('Channel', 'start');","import {assert} from './utils';\n\n//can just pass string (get promise), string and callback (callback), or object with named consumers\nexport function connect(serviceName, callback) {\n  if (typeof serviceName === 'object') {\n    return connectConsumers(this, serviceName);\n  } else if (callback) {\n    return connectCallbacks(this, serviceName, callback);\n  } else {\n    return connectPromise(this, serviceName);\n  }\n}\n\nexport function registerHandler (pokey, serviceName, options) {\n  let port = pokey.ports[serviceName];\n\n  if (port) {\n    //todo\n  }\n}\n\nexport function portFor(serviceName) {\n  var port = this.ports[serviceName];\n  assert(port, \"You asked for the port for the service named '\" + serviceName + \", but the environment did not provide one.\");\n  return port;\n}\n\nfunction connectPromise (pokey, serviceName) {\n  //todo\n}\n\nfunction connectCallbacks (pokey, serviceName, callback) {\n  //todo\n}\n\nfunction connectConsumers (pokey, consumerMap) {\n  //todo\n}","export default class Events {\n  constructor () {\n    this.subscribers = {};\n  }\n\n  on (eventName, listener) {\n    let listeners = (this.subscribers[eventName] = this.subscribers[eventName] || []);\n\n    listeners.push(listener);\n  }\n\n  off (eventName, listener) {\n    let listeners = this.subscribers[eventName];\n    if (!listeners) {\n      return;\n    }\n\n    for (var i = 0; i < listeners.length; ++i) {\n      if (listeners[i] === listener) {\n        listeners.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  clear (eventName) {\n    delete this.subscribers[eventName];\n  }\n\n  trigger (eventName) {\n    var listeners = this.subscribers[eventName];\n    if (!listeners) {\n      return;\n    }\n\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    for (var i = 0; i < listeners.length; ++i) {\n      listeners[i].apply(null, args);\n    }\n  }\n}","import Service from './service';\nimport Sandbox from './sandbox';\nimport Events from './events';\nimport { connect, portFor } from './connect';\n\nimport AdapterIFrame from './adapter_iframe';\n\nclass Pokey {\n  constructor () {\n    this.pokeyId   = 'pokey' + (+new Date());\n    this.requestId = 0;\n\n    this.consumers = {};\n    this.services  = [];\n\n    this.ports    = {};\n    this.handlers = {};\n\n    this.receivedPorts = false;\n\n    this.configuration = {\n      eventCallback  : (callback) => { return callback() },\n      allowSameOrigin: false,\n      reconnect      : 'verify' //todo - allow setting to 'none, 'any'\n    };\n\n    this.events = new Events();\n\n    this.onCreate();\n  }\n\n  //noop for now\n  onCreate () {}\n\n  /**\n   * entry point for containing environment to create child sandbox\n   * @param options with fields\n   * services\n   * url - url for JS file that will initialize sandbox in sandboxed environment\n   * //todo - multiple types - iframe, workers\n   */\n  createSandbox (options) {\n    return new Sandbox(this, options);\n  }\n\n}\n\nObject.assign(Pokey, {\n\n  connect: connect,\n\n  portFor : portFor,\n\n  adapters : {\n    iframe: new AdapterIFrame()\n\n    //in a future version...\n    //webworker: new WebworkerAdapter(),\n    //inline: new InlineAdapter()\n  }\n});\n\nexport default Pokey;","import {noop, mustImplement} from './utils';\n\nclass Port {\n  constructor (pokey, port) {\n\n  }\n\n  request (eventName) {\n    //todo\n  }\n\n  onRequest (eventName, callback, binding) {\n    //todo\n  }\n\n}\n\n//Interface-like --- throw error unless all are implemented\n['on', 'all', 'off', 'send', 'start', 'close']\n  .forEach((method) => {\n    Port[method] = mustImplement('Port', method);\n  });\n\nexport default Port;","import {assert} from './utils';\n\nexport class Sandbox {\n  constructor (pokey, opts) {\n\n    let options = Object.assign({}, pokey.configuration, opts);\n    assert(['none', 'verify'].indexOf(options.reconnect) > -1, 'Reconnect must be either \"none\" or \"verify\".');\n\n    //todo - verify this bit\n    let capabilities = options.capabilities;\n    assert(capabilities, 'You must provide a list of services you wish to expose/use on options.capabilities');\n\n    this.adapter = options.adapter || pokey.adapters.iframe;\n\n    this.pokey = pokey;\n\n\n    this.connections = {};\n    //let other things listen in\n    this.wiretaps     = [];\n    this.channels     = {};\n    this.capabilities = {};\n    this.options      = options;\n\n    //todo\n    this._waitForLoadPromise = new Promise();\n\n    this.firstLoad = true;\n\n    this.adapter.initializeSandbox(this);\n  }\n\n  createAndTransferCapabilities () {\n    if (!this.firstLoad) {\n      this.promisePorts();\n    }\n\n    this.createChannels();\n    this.connectPorts();\n\n    // subsequent calls to `createAndTransferCapabilities` requires new port promises\n    this.firstLoad = false;\n  }\n\n  promisePorts () {\n\n  }\n\n  createChannels() {\n\n  }\n\n  connectPorts () {\n\n  }\n\n  destroyChannels () {\n\n  }\n\n  waitForLoad () {\n\n  }\n\n  wiretap () {\n\n  }\n\n  connect () {\n\n  }\n\n  start () {\n\n  }\n\n  terminate () {\n\n  }\n\n  onerror (error) {\n    throw error;\n  }\n\n\n}","/**\n Base class services (in containing environment) + consumers (in sandbox) can subclass to implement several events + requests\n\n accepts\n\n initialize (function) - called when other side initiates connection\n\n events (object) - map of event names and callbacks, called when other end triggers respective event\n\n requests (object) - map of request names and callbacks, called when other end requests\n */\n\nclass Service {\n  constructor (port, sandbox, params = {}) {\n    let self = this;\n\n    this.port    = port;\n    this.sandbox = sandbox;\n\n    function wrapCb (cb) {\n      return function () {\n        return cb.apply(self, arguments);\n      }\n    }\n\n    for (let prop in params.events) {\n      let callback = params.events[prop];\n      port.on(prop, wrapCb(callback));\n    }\n\n    for (let prop in params.requests) {\n      let callback = params.requests[prop];\n      port.onRequest(prop, wrapCb(callback));\n    }\n  }\n\n  initialize() {}\n\n  error() {}\n\n  destroy() {}\n\n  /**\n   *\n   * @param {String} eventName\n   * @param {Structured} data\n   * @returns {*}\n   * //todo - ensure this binding\n   */\n  send(...args) {\n    return this.port.send(...args);\n  }\n\n  /**\n   *\n   * @param {String} requestName\n   * @param {Promise} promise resolved by other end\n   * @returns {*}\n   * //todo - ensure this binding\n   */\n  request(...args) {\n    return this.port.request(...args);\n  }\n}\n\nexport default Service;","export function noop () { }\n\nexport function assert (string, assertion) {\n  if (!assertion) {\n    throw new Error(string);\n  }\n}\n\nexport function isInWorker () {\n  return typeof Worker === 'undefined' && typeof Window === 'undefined';\n}\n\nexport function mustImplement (className, name) {\n  return function () {\n    throw new Error(\"Subclass of \" + className + \" must implement \" + name);\n  };\n}\n\n//RFC1422 v4 compliant UUID, using time for more uniqueness\nexport function UUID () {\n  function generateUUID () {\n    var d = new Date().getTime();\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      var r = (d + Math.random() * 16) % 16 | 0;\n      d     = Math.floor(d / 16);\n      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n    });\n  }\n}\n\nexport function isUrl (s) {\n  var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\n  return regexp.test(s);\n}"]}